# Анализ различий между средами

## Проблема
В Google AI Studio проект получает данные по символам, а локально - нет. Проект один и тот же, отличается только среда развертывания.

## Обнаруженные различия

### 1. Параметр `wt: true` в логине
**Файл:** `context/AuthContext.tsx:52`
```javascript
body: JSON.stringify({ email, password, wt: true }),
```

**Возможное значение:**
- `wt` может означать "WebSocket Token" или "Web Trading"
- Этот параметр влияет на то, возвращается ли `utipToken` в ответе
- `utipToken` используется для подключения к WebSocket (приоритет над `acsToken`)

**Гипотеза:** В Google AI Studio этот параметр может работать по-другому, или сервер там обрабатывает его иначе.

### 2. Различия в окружении

#### Google AI Studio:
- Использует `importmap` для загрузки React из CDN
- Возможно, есть прокси или дополнительная инфраструктура
- Origin: `https://ai.studio` или подобный
- Может быть другая обработка CORS/WebSocket

#### Локальная среда:
- Vite dev server на `localhost:3000`
- Origin: `http://localhost:3000`
- React загружается из `node_modules`

### 3. WebSocket сообщения

**Что приходит локально:**
- ✅ `serverName`
- ✅ `traderType`
- ✅ `holidays`
- ✅ `symbolGroups`
- ❌ `symbols` - НЕ ПРИХОДИТ

**Что должно приходить (судя по скриншоту Google AI Studio):**
- ✅ `symbols` с массивом `symbolsArray`

## Возможные причины

### 1. Проблема с токеном
- Возможно, `utipToken` не возвращается при логине локально
- Или `utipToken` отличается между средами
- Проверка: посмотреть, что возвращается в ответе логина

### 2. Проблема с Origin/Referer
- Сервер может проверять Origin заголовок
- Локально: `http://localhost:3000`
- Google AI Studio: `https://ai.studio` или другой домен
- Сервер может блокировать запросы с определенных origin

### 3. Проблема с User-Agent или другими заголовками
- Браузер в Google AI Studio может отправлять другие заголовки
- Сервер может проверять User-Agent

### 4. Проблема с последовательностью сообщений
- Возможно, нужно дождаться определенных сообщений перед запросом символов
- Или нужно отправить дополнительный запрос после `symbolGroups`

### 5. Проблема с параметром `wt`
- Если `wt: false` или отсутствует, сервер может не отправлять `symbols`
- Или может отправлять в другом формате

## Что проверить

1. **Сравнить токены:**
   ```javascript
   // В консоли браузера
   console.log('ACS Token:', localStorage.getItem('acsToken'));
   console.log('UTIP Token:', localStorage.getItem('utipToken'));
   ```

2. **Проверить ответ логина:**
   - Открыть Network -> login запрос
   - Посмотреть, что возвращается в ответе
   - Сравнить с тем, что возвращается в Google AI Studio

3. **Проверить WebSocket заголовки:**
   - В Network -> WS -> Headers
   - Сравнить Origin, User-Agent и другие заголовки

4. **Проверить все WebSocket сообщения:**
   - В Network -> WS -> Messages
   - Посмотреть, какие сообщения приходят после `symbolGroups`
   - Есть ли `optionsSettings` или другие сообщения

5. **Проверить параметр `wt`:**
   - Попробовать изменить `wt: true` на `wt: false`
   - Или убрать параметр совсем
   - Посмотреть, изменится ли поведение

6. **Проверить timeout:**
   - Возможно, сообщение `symbols` приходит с задержкой
   - Подождать дольше после получения `symbolGroups`

## Рекомендации

1. Добавить логирование всех WebSocket сообщений для сравнения
2. Сравнить Network запросы между двумя средами
3. Проверить, не блокируется ли запрос на уровне сервера
4. Проверить, есть ли различия в версиях браузеров



